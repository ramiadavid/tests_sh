#!/bin/bash

# Create odoo user
id -u odoo &>/dev/null || useradd -m -d /home/odoo -U -r -s /bin/bash odoo

# Prepare filesystem
su -c "mkdir -p /home/odoo/data" odoo
su -c "mkdir -p /home/odoo/src" odoo
su -c "mkdir -p /home/odoo/logs" odoo
su -c "mkdir -p /home/odoo/tmp" odoo
su -c "touch /home/odoo/odoo.conf" odoo

pip install pip --upgrade
pip install wheel
pip install docopt
pip install pdfminer
pip install phonenumbers

ssh-keyscan github.com >> ~/.ssh/known_hosts
systemctl daemon-reload
systemctl enable --now odoo

# Install jupyterlab
python3 -m venv /opt/odoo.sh/jupyterlab
chown odoo -R /opt/odoo.sh
su -c "/opt/odoo.sh/jupyterlab/bin/pip install jupyterlab" odoo
su -c "/opt/odoo.sh/jupyterlab/bin/pip install markupsafe==2.0.1" odoo
systemctl enable --now jupyterlab
